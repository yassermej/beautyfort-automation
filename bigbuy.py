# -*- coding: utf-8 -*-
import os
import uuid
import base64
import hashlib
import string
import random
import time
from datetime import datetime
import requests
from requests.adapters import HTTPAdapter

# 3rd party libraries
from peewee import *
from lxml import etree
import pandas as pd
import shopify

from env import *

import pdb

s = requests.Session()
s.mount('https://api.bigbuy.eu', HTTPAdapter(max_retries=5))

# write db file
base_dir = os.path.dirname(os.path.abspath(__file__))
db = SqliteDatabase(base_dir+'/app.db')


# define tables
class BaseModel(Model):
    class Meta:
        database = db


class BigBuyProduct(BaseModel):
    product_id = TextField()
    name = TextField()
    sku = TextField()
    ean13 = TextField()
    image = TextField()
    category = TextField()
    retail_price = TextField()
    wholesale_price = TextField()
    depth = TextField()
    description = TextField()
    tags = TextField()


def initialize_db():
    db.connect()
    db.create_tables([BigBuyProduct,], safe = True)
    db.close()

def encode_sha1(message):
    base64_bytes = base64.b64encode(message.encode('ascii'))
    return base64_bytes.decode('ascii')


def generate_random():
    letters = string.digits
    return ''.join(random.choice(letters) for i in range(6))

def extract_first(val):
    return val[0] if len(val) > 0 else ''


class BigBuy:
    def __init__(self):
        self.api_url = 'https://api.bigbuy.eu'
        self.headers = {
            'Authorization': 'Bearer ' + BIGBUY_API_KEY,
            'Content-Type': 'application/json'
        }

    def get_products(self):
        url = '/rest/catalog/products.json?isoCode=en'
        products = requests.get(self.api_url+url, headers=self.headers)
        return products.json()

    def get_image_by_id(self, id):
        url = '/rest/catalog/productimages/{}.json?isoCode=en'.format(id)
        image = requests.get(self.api_url+url, headers=self.headers)
        image_data = image.json()
        try:
            if len(image_data['images']) > 0:
                return image_data['images'][0]['url']
        except Exception as ee:
            print(image_data)
            print("get_image_by_id: {}".format(str(ee)))
            pass
        return ''

    def get_tags(self, product_id):
        url = '/rest/catalog/producttags/{}.json?isoCode=en'.format(product_id)
        res = requests.get(self.api_url+url, headers=self.headers)

        try:
            tags = res.json()
            tag_str = ''
            if len(tags) > 0:
                tag_str = ','.join(x['name'] for x in tags)
            return tag_str
        except Exception as ee:
            print(str(ee))
            return ''

    def products_by_id(self, product_id):
        url = '/rest/catalog/product/{}.json?isoCode=en'.format(product_id)
        try:
            res = requests.get(self.api_url+url, headers=self.headers).json()
            if 'code' in res:
                return None
            else:
                return res
        except:
            return None

    def products_by_category(self, category):
        url = '/rest/catalog/productscategories.json?isoCode=en'
        result = []
        res = requests.get(self.api_url+url, headers=self.headers)
        try:
            products = res.json()
            for product in products:
                if product['category'] == category:
                    result.append(product['product'])
        except Exception as ee:
            print("@@@@ Product Categories API limit @@@@: ")
            pass
        return result

    def producttag_by_id(self, product_id):
        url = '/rest/catalog/producttags/{}.json?isoCode=en'.format(product_id)
        try:
            res = requests.get(self.api_url+url, headers=self.headers)
            return ','.join(x['name'] for x in res.json())
        except:
            print('producttag_by_id')


    def product_information(self, product_id):
        url = '/rest/catalog/productinformation/{}.json?isoCode=en'.format(product_id)
        try:
            res = requests.get(self.api_url+url, headers=self.headers)
            return res.json()
        except:
            print("Product information error")
            return None

    def stock_by_id(self, product_id):
        url = '/rest/catalog/productstock/{}.json?isoCode=en'.format(product_id)
        try:
            res = requests.get(self.api_url+url, headers=self.headers).json()
            if 'stocks' in res and len(res['stocks']) > 0:
                return str(res['stocks'][0]['quantity'])
            return '0'
        except:
            return '0'

def upload_product(api, product, variant, entry):
    # save image
    if len(product.images) == 0 and entry.image != '':
        # pull product information from BigBuy
        try:
            image_data = requests.get(entry.image).content

            image = shopify.Image({ 'product_id': product.id })
            image.attach_image(image_data, filename=entry.name.replace(' ', '_'))
            image.save()

            product.images = [image]
            variant.image = image
            product.save()
        except:
            print("image upload issue: {}, product_image: {}".format(product.id, entry.image))

def validate_cell(val):
    return val if str(val) else ''


def run_shopify_upload(entry, api):
    res = shopify.Product().find(title=entry.name)

    if len(res) > 0:
        product = res[0]
        variants = product.variants
        if len(variants) == 1:
            variant = variants[0]

            variant.compare_at_price = validate_cell(entry.retail_price)
            variant.sku = entry.sku
            variant.save()

            inventory_item = shopify.InventoryItem().find(variant.inventory_item_id)
            inventory_item.cost = validate_cell(entry.wholesale_price)
            inventory_item.country_code_of_origin = 'GB'
            inventory_item.sku = entry.sku
            inventory_item.tracked = True
            inventory_item.save()

        try:
            product.save()
        except:
            res = shopify.Product().find(title=entry.name)
            product = res[0]
            product.save()

        time.sleep(1)

        # save image 
        upload_product(api, product, variant, entry)

        print("Product is updated successfully. Id is {}!  ".format(product.id))
    else:
        # Create product
        product = shopify.Product()
        product.title = entry.name
        product.body_html = entry.description
        product.tags = entry.tags.split(',')
        product.vendor = 'BigBuy'
        product.product_type = entry.category

        variant = shopify.Variant()
        product.variants =[variant]
        product.save()

        time.sleep(1)
        variant.product_id = product.id
        variant.compare_at_price = validate_cell(entry.retail_price)
        variant.sku = entry.sku
        variant.fulfillment_service = 'manual'
        variant.inventory_management = 'shopify'
        product.variants =[variant]
        product.save()

        time.sleep(1)


        variant = product.variants[0]
        inventory_item = shopify.InventoryItem().find(variant.inventory_item_id)
        inventory_item.cost = validate_cell(entry.wholesale_price)
        inventory_item.country_code_of_origin = 'GB'
        inventory_item.sku = entry.sku
        inventory_item.tracked = True
        inventory_item.save()

        inventory_levels = shopify.InventoryLevel().find(inventory_item_ids=variant.inventory_item_id)
        if len(inventory_levels) > 0:
            inventory_levels[0].set(inventory_item_id=variant.inventory_item_id,
                                available=str(product_quantity),
                                location_id=str(inventory_levels[0].location_id))


        try:
            product.save()
        except:
            print('reconnected again: @@@@@@@@@@@@@@')
            res = shopify.Product().find(title=entry.name)
            product = res[0]
            product.save()

        # save image 
        upload_product(api, product, variant, entry)
        print("Product is saved successfully. Id is {}!  ".format(product.id))


if __name__ == "__main__":
    initialize_db()

    shop_url = "https://%s:%s@%s.myshopify.com/admin" % (KITCHEN_SHOP_API_KEY, KITCHEN_SHOP_PASSWORD, 'kitchenseasyzk')
    shopify.ShopifyResource.set_site(shop_url)


    kitchen_category = 2403

    ## create api instance
    api = BigBuy()
    products = api.products_by_category(kitchen_category)

    # products = [104349, 91351, 104360, 105978, 104370, 132737, 135984, 135991, 111472, 118441, 134404, 118482, 13250, 112566, 134420, 101344, 118495, 112588, 95101, 120006, 125925, 43391, 84491, 43435, 136121, 125948, 125957, 14199, 120069, 91608, 101462, 132886, 126399, 118568, 133161, 63207, 63210, 133178, 118591, 134528, 34979, 133195, 112758, 134544, 66844, 133211, 112775, 43649, 134560, 14405, 63271, 133227, 134576, 63292, 133243, 63314, 133259, 95363, 132999, 63366, 133275, 133016, 63383, 133034, 54805, 63403, 67109, 54821, 133051, 17459, 71629, 63433, 17482, 27954, 54851, 71637, 68240, 124796, 101634, 133069, 63538, 111819, 54885, 118864, 133085, 126168, 95555, 133101, 120326, 118910, 63653, 17630, 54996, 120346, 114228, 118930, 55020, 133365, 122969, 44588, 133381, 133397, 117283, 63775, 120419, 129944, 93462, 133415, 129948, 101745, 84875, 117310, 69664, 44871, 44881, 119060, 90011, 117331, 64005, 69705, 64018, 64043, 64061, 69761, 45158, 117377, 130914, 64102, 130929, 117395, 64205, 95923, 64227, 126865, 120588, 133570, 117417, 120596, 95978, 120617, 117443, 117462, 55654, 117469, 90321, 110631, 134883, 46217, 117494, 134901, 75876, 121737, 134926, 46277, 29110, 121753, 46298, 96210, 87528, 120738, 123853, 29354, 29456, 120772, 135022, 46632, 101153, 73190, 46654, 119400, 119407, 101164, 73221, 56807, 56810, 46760, 135073, 90686, 117657, 90689, 88234, 121939, 133867, 46825, 121958, 46838, 46848, 46859, 117705, 64653, 117718, 117734, 117747, 123435, 130440, 133959, 130450, 85934, 32883, 94426, 125439, 135607, 105591, 85952, 135623, 116412, 124040, 135639, 33319, 97013, 85973, 116438, 122117, 135655, 122122, 115045, 135671, 127370, 117851, 65243, 135687, 122162, 127386, 125518, 118122, 135703, 117868, 127402, 118151, 122183, 117903, 117907, 117912, 135740, 130567, 117922, 135756, 135392, 104226, 82685, 135772, 117937, 105752, 94649, 117941, 102527, 135788, 65572, 50797, 135815, 118294, 135846, 62260, 135862, 132660, 135880, 86193, 119824, 118367, 135921, 122370, 122386, 124324, 101252, 80031, 94863, 118435, 107329, 118447, 135574, 58429, 134415, 101339, 118490, 99995, 118521, 125919, 84484, 43428, 136116, 125943, 13706, 125953, 101445, 118539, 41485, 120057, 133124, 101457, 125972, 126393, 118563, 133156, 125993, 133173, 118583, 134523, 133190, 134539, 43535, 14387, 133206, 134555, 118630, 133222, 134571, 63287, 114051, 133238, 111723, 122811, 95305, 63307, 43720, 133254, 67034, 133270, 114126, 133010, 63378, 67053, 133029, 97935, 63397, 133045, 63427, 133064, 118847, 17508, 120286, 69112, 133080, 133096, 118884, 54950, 133112, 54965, 117211, 55014, 120363, 95619, 84831, 133376, 118965, 98223, 133392, 117277, 63768, 133410, 117305, 101750, 89972, 35500, 69686, 69719, 69749, 120525, 130924, 117392, 64177, 119125, 117402, 133558, 117414, 126873, 95993, 120614, 45955, 55646, 116004, 117466, 130158, 123726, 87357, 134878, 46211, 110646, 134895, 117502, 101031, 134916, 46266, 87427, 121750, 56517, 46294, 119301, 96189, 119311, 120735, 117555, 112223, 120754, 117578, 117588, 116172, 120783, 46610, 120788, 135033, 117604, 29645, 117609, 46643, 37483, 117613, 37487, 130313, 90657, 114711, 46712, 101178, 56801, 117633, 57009, 46775, 30030, 135084, 121933, 123912, 46789, 133862, 119454, 96460, 64635, 32591, 117715, 122034, 130420, 122038, 110941, 123430, 130435, 57378, 130445, 32845, 109579, 130455, 118021, 118026, 33019, 99301, 135602, 117783, 117789, 122085, 33231, 135634, 122113, 135650, 116452, 135666, 117844, 96661, 65238, 135682, 127381, 125513, 102410, 65258, 135698, 122171, 127397, 125531, 135336, 123570, 118139, 117881, 122180, 123599, 118184, 94624, 135735, 130560, 117919, 135751, 135387, 130585, 118218, 135767, 135783, 50790, 131454, 117952, 118284, 135810, 117967, 34302, 135827, 135857, 82902, 34483, 34486, 118363, 118372, 86212, 122381, 122392, 101237, 92678, 101247, 104355, 135985, 136007, 136024, 135569, 58423, 134410, 122479, 101334, 104429, 118510, 113880, 125914, 41275, 84478, 43407, 125938, 43456, 120052, 133118, 62774, 101453, 133151, 125988, 101480, 132894, 132897, 133168, 118578, 133185, 101503, 134534, 100318, 133201, 134550, 112770, 101539, 133217, 112781, 118641, 134566, 63278, 133233, 118662, 103150, 63302, 133249, 110219, 63325, 118719, 133265, 133005, 63372, 54756, 133023, 63390, 86663, 118814, 133040, 118821, 63422, 27915, 133059, 54857, 120283, 133075, 54894, 103287, 69131, 28126, 133091, 54922, 28180, 133107, 118889, 54974, 117218, 104866, 55005, 118940, 120354, 95612, 55028, 44511, 69249, 55032, 133371, 133387, 63761, 86948, 133405, 129937, 101735, 133421, 44808, 84881, 117321, 63810, 109098, 129999, 44901, 130008, 117371, 112010, 75567, 130919, 117387, 117411, 95986, 70075, 64299, 115997, 84179, 64303, 46120, 55652, 123719, 105202, 134873, 117474, 87372, 116056, 134890, 120696, 134908, 116077, 46261, 112183, 134932, 121747, 29125, 46289, 75971, 116119, 120717, 29193, 85780, 116140, 96290, 29414, 46508, 117595, 130266, 135028, 117601, 85812, 46638, 135044, 56763, 46664, 116231, 85837, 117627, 46725, 46733, 29993, 135079, 110828, 57097, 90694, 30049, 23067, 121946, 46812, 96453, 112332, 88261, 121968, 64630, 117711, 90796, 96500, 117728, 60380, 105520, 64800, 57364, 132434, 133963, 32909, 85945, 33059, 116406, 135629, 65126, 85962, 135645, 116446, 102394, 135661, 117840, 102397, 65229, 118102, 135677, 127376, 105653, 118113, 65252, 122158, 135693, 127392, 102418, 82500, 86018, 118132, 86022, 117876, 122177, 33682, 123608, 130555, 123619, 135746, 130573, 130579, 118213, 135762, 135398, 117933, 130602, 135778, 50779, 131459, 135805, 117959, 135822, 62242, 135852, 82894, 62336, 119816, 132668, 135887, 135927, 104361, 105979, 104371, 135992, 136002, 65979, 86258, 118442, 136018, 58419, 118473, 134405, 58432, 118477, 118483, 104440, 134421, 101345, 118496, 136061, 125909, 118517, 125926, 43393, 125935, 106108, 84492, 43442, 62770, 133113, 125958, 101463, 132887, 132891, 14314, 133162, 133179, 134529, 43533, 133196, 134545, 66848, 133212, 134561, 63272, 133228, 134577, 110200, 63297, 43714, 133244, 110210, 17223, 122831, 133260, 95364, 133000, 117114, 63367, 133276, 133018, 63384, 133035, 63413, 27907, 133052, 54843, 63434, 27955, 124797, 133070, 118855, 63539, 54888, 95534, 133086, 54901, 126169, 54930, 133102, 98102, 54998, 118918, 52392, 118927, 55021, 122963, 133366, 95633, 44592, 133382, 117268, 63755, 122985, 98245, 120399, 133398, 101730, 63776, 69583, 129945, 93464, 133416, 106507, 44765, 84876, 115813, 83720, 117318, 44873, 119057, 129994, 119061, 111965, 69706, 64028, 103522, 83822, 69762, 75562, 130915, 117384, 95886, 130930, 101904, 95924, 114449, 126866, 133572, 126893, 95979, 123716, 117490, 117499, 117519, 116110, 64654, 125909, 64694, 44592, 133572, 125926, 125935, 117592, 129945, 44765, 135594, 125958, 64982, 44873, 129994, 117624, 135624, 14314, 134884, 135640, 120693, 134902, 135656, 85865, 75562, 134927, 135672, 29111, 65245, 117706, 135688, 29159, 135704, 105506, 126866, 117725, 17223, 122831, 117736, 29355, 126893, 117748, 135741, 120777, 85928, 65392, 135023, 135757, 119383, 29605, 83720, 135039, 27907, 135773, 119408, 27955, 135793, 85953, 124797, 65574, 116414, 102377, 135816, 135074, 126169, 75878, 46258, 83822, 58419, 117837, 102390, 62233, 116465, 135847, 133868, 58432, 117848, 46285, 105648, 86006, 122963, 135881, 117900, 122985, 32629, 117908, 133960, 73121, 117930, 46633, 32888, 86059, 117938, 104227, 73191, 46655, 135992, 102528, 132887, 117948, 33134, 132891, 136002, 65979, 117956, 46761, 136018, 119652, 46804, 33403, 98102, 118109, 46856, 136061, 46862, 110200, 33545, 110210, 114449, 118152, 98245, 133000, 130431, 62770, 133018, 133030, 130446, 135388, 34162, 130456, 123713, 133046, 133065, 86255, 133081, 66751, 118290, 133097, 66829, 121741, 34424, 106042, 63265, 101340, 66927, 127382, 127398, 63308, 118373, 84485, 63379, 67054, 130561, 101446, 130574, 63398, 101458, 130592, 63429, 111962, 118418, 118436, 69140, 118448, 123913, 86453, 134416, 118491, 130925, 123948, 118514, 84646, 118522, 93095, 82503, 132116, 118533, 63770, 123431, 41468, 120058, 69634, 133125, 63820, 69693, 118564, 133157, 118574, 133174, 103288, 123506, 118584, 134524, 69751, 118595, 133191, 54940, 134540, 101667, 122128, 133207, 122141, 134556, 118631, 64178, 133223, 55016, 134572, 56519, 95620, 133239, 123571, 133255, 117278, 122187, 133271, 43431, 117306, 101741, 117314, 101751, 127797, 117335, 120279, 117339, 118848, 118860, 99388, 117381, 120341, 95900, 117399, 35400, 133377, 118968, 117421, 133393, 60378, 117436, 122382, 120405, 95994, 133411, 117456, 122432, 117487, 120526, 93829, 112578, 119129, 96192, 64641, 117556, 44578, 125920, 117569, 117579, 120602, 117583, 117589, 125944, 64814, 35949, 135603, 125973, 129988, 117621, 116240, 134879, 131455, 117639, 135635, 14343, 130021, 120690, 134896, 135651, 134917, 126789, 135667, 29101, 65239, 112771, 96461, 135683, 135699, 117722, 29333, 117742, 135736, 45956, 135752, 114144, 119377, 135034, 135768, 117784, 102364, 135784, 17485, 119415, 135811, 135069, 17560, 46230, 117834, 135828, 30035, 135085, 135842, 133863, 46281, 102400, 135858, 75969, 126213, 135876, 46304, 86015, 135917, 117896, 122977, 86029, 81541, 46495, 94625, 117916, 130256, 119553, 117926, 46618, 118001, 118022, 119589, 46645, 118027, 105745, 135986, 132884, 130315, 50791, 18715, 46714, 33233, 132900, 117968, 119649, 33290, 46768, 50896, 88259, 136072, 132995, 130421, 136117, 133011, 130436, 101238, 133024, 104356, 101248, 118214, 133041, 135399, 133060, 133076, 81978, 63212, 133092, 118296, 121738, 133108, 123270, 101335, 34453, 121754, 127377, 63279, 127393, 63303, 123854, 63326, 84479, 63374, 130556, 63392, 130580, 101454, 63423, 68181, 130604, 101481, 130867, 69132, 135570, 63569, 134411, 118484, 130920, 82390, 103151, 63762, 120053, 54790, 133119, 63811, 54827, 125449, 54852, 133152, 118570, 133169, 103281, 118579, 124041, 54895, 118592, 54923, 133186, 134535, 122119, 118608, 133202, 134551, 117219, 54977, 64135, 133218, 122155, 118642, 82895, 55006, 134567, 56503, 106456, 95613, 133234, 125527, 123566, 55033, 133250, 122184, 118721, 133266, 56627, 43408, 56632, 101736, 43457, 117311, 84882, 118815, 118822, 105002, 117327, 117332, 118841, 126387, 56811, 103523, 43532, 99402, 117378, 71232, 118890, 120327, 112334, 117396, 120355, 133372, 117418, 120378, 133388, 122371, 122375, 133406, 57366, 122393, 125771, 133422, 122428, 119045, 71630, 117470, 105203, 71639, 116057, 116078, 120521, 43046, 112567, 117534, 116120, 112589, 64679, 125915, 116141, 125939, 64802, 129938, 120618, 125954, 125963, 129982, 130000, 116235, 44903, 125989, 134874, 130009, 135630, 116251, 120686, 134891, 94188, 135646, 134909, 135662, 65230, 134933, 96454, 135678, 65253, 112782, 14717, 120721, 135694, 100000, 117719, 29263, 29416, 27596, 135747, 135763, 46123, 102361, 46137, 135045, 117790, 135779, 17461, 28030, 116408, 135806, 46218, 135823, 135080, 116447, 90395, 46278, 135853, 46299, 117869, 135888, 117877, 122970, 104155, 46443, 117904, 117913, 46509, 109287, 117923, 130267, 117934, 46639, 86060, 50761, 117942, 50781, 98039, 132895, 46737, 33258, 46826, 118103, 46840, 134055, 118115, 118119, 121619, 118123, 118133, 133006, 130442, 104351, 101243, 86224, 133036, 130452, 104362, 105980, 135394, 133053, 134154, 133071, 118286, 133087, 121735, 34390, 133103, 121751, 98422, 127372, 63273, 106056, 101346, 127388, 63298, 118360, 118364, 127404, 63368, 63385, 130569, 104526, 63415, 130586, 101464, 63437, 86388, 118443, 135565, 109656, 121942, 118474, 134406, 118478, 130916, 134422, 130931, 132106, 110523, 63756, 63777, 123437, 54748, 69614, 133114, 86656, 130736, 133147, 101167, 69707, 133163, 54889, 54905, 64047, 133180, 134530, 54931, 133197, 117208, 122124, 54952, 134546, 54966, 133213, 55000, 134562, 125509, 52393, 133229, 118658, 55022, 112209, 134578, 133245, 117252, 55044, 122181, 123584, 133261, 43394, 84859, 117293, 133277, 101731, 43445, 84877, 101747, 70903, 118810, 115817, 117322, 118856, 120287, 56803, 56808, 97003, 57010, 118885, 117393, 95887, 118928, 118937, 117403, 133367, 117415, 133383, 57286, 95980, 43727, 120400, 133401, 122388, 133417, 57379, 35507, 117460, 117467, 35566, 71641, 117503, 13252, 64660, 125910, 44598, 133573, 125927, 120615, 125950, 129946, 125959, 35946, 117610, 121157, 129995, 135625, 125994, 105384, 134885, 135641, 134903, 135657, 134928, 117683, 14388, 107623, 135673, 65248, 117707, 122656, 135689, 29164, 121238, 117716, 119312, 120736, 135705, 126867, 126876, 117737, 126895, 117749, 111358, 120785, 65393, 114145, 135024, 135758, 119384, 109094, 135040, 135774, 124799, 65575, 46212, 116430, 135818, 29947, 135075, 116442, 83823, 46273, 58430, 117845, 135848, 133869, 81405, 105649, 135864, 46296, 135883, 32593, 122967, 117901, 109219, 86030, 122986, 117909, 96730, 117920, 130262, 117931, 46634, 118017, 117939, 97965, 104228, 46656, 135987, 50773, 105757, 117945, 96791, 135993, 102529, 117949, 98003, 117953, 136003, 73224, 46763, 136019, 46778, 46790, 33398, 123064, 136062, 39387, 118128, 90797, 114447, 110211, 47066, 98246, 133001, 136111, 133019, 133031, 130447, 63013, 135389, 133048, 133066, 133082, 118291, 75568, 135668, 133208, 134557, 135684, 133224, 64633, 134573, 96194, 64644, 117713, 135700, 113881, 133240, 133256, 132996, 84471, 117730, 133272, 84486, 117743, 133012, 135737, 133031, 119555, 135753, 118002, 133048, 118023, 119590, 135769, 117785, 133066, 135785, 124026, 133082, 118059, 135812, 75867, 133098, 102388, 121197, 135843, 116457, 117842, 65240, 106043, 118110, 135859, 121222, 135877, 84648, 135918, 133378, 133394, 43432, 133412, 91606, 129989, 50793, 73215, 102548, 130876, 118291, 50897, 62253, 29105, 130926, 99998, 122961, 100005, 132117, 133564, 118374, 29339, 43725, 96728, 94628, 136118, 14203, 134880, 118437, 29911, 134897, 134918, 100320, 44485, 14392, 101341, 118492, 14404, 104872, 118511, 44579, 118527, 125932, 32705, 125945, 130257, 101447, 63013, 120059, 32859, 101459, 125974, 27941, 118565, 100557, 33234, 135070, 118587, 135086, 133864, 121748, 63266, 118634, 66928, 39382, 63289, 63309, 103173, 130422, 63380, 67055, 130437, 130447, 63399, 63430, 118849, 120284, 54858, 56794, 103282, 46204, 18740, 103289, 69145, 57108, 54943, 46262, 101668, 135277, 63655, 127367, 120342, 46291, 127383, 55017, 55029, 127399, 117279, 63772, 40292, 130563, 101742, 117307, 127459, 130575, 101752, 135389, 46626, 71019, 63821, 46648, 69694, 85949, 117341, 131456, 46716, 69723, 46726, 123507, 103524, 117372, 46772, 122114, 101034, 64089, 115041, 122129, 46818, 117388, 64179, 101900, 122159, 95621, 86016, 117412, 122178, 70077, 86037, 117476, 120697, 134417, 95901, 110201, 117557, 95996, 86215, 122383, 117593, 122395, 133120, 103816, 132882, 133153, 117625, 132898, 135631, 133170, 135647, 133187, 58420, 134536, 119451, 75565, 135663, 133203, 58433, 134552, 135679, 133219, 134568, 117702, 135695, 133235, 133251, 86327, 117726, 96293, 133267, 84480, 133007, 135732, 64803, 133025, 135748, 104357, 35504, 133042, 135764, 125431, 35550, 133061, 135780, 111966, 133077, 116410, 102378, 65130, 135807, 116425, 133093, 118069, 135824, 117832, 112019, 133109, 102391, 116448, 117838, 65231, 112766, 96455, 118104, 135854, 102406, 65254, 118116, 112783, 82896, 118120, 125528, 133373, 117878, 133389, 117905, 43421, 118193, 133407, 129940, 43459, 35944, 118215, 117935, 50763, 73192, 135988, 133496, 50784, 130010, 118280, 117957, 65654, 136020, 136026, 136035, 62234, 130921, 29131, 114227, 94564, 29282, 118369, 91913, 101239, 101249, 65924, 134875, 118424, 14334, 29886, 134892, 123041, 30006, 134910, 134934, 101336, 118486, 118518, 114450, 125916, 17240, 92150, 32632, 125940, 120054, 130268, 135030, 27850, 105003, 32988, 135046, 94859, 130310, 33089, 125990, 101482, 118580, 135081, 101504, 118610, 33407, 121745, 118643, 56514, 63281, 63304, 118723, 117116, 63375, 130432, 63393, 133961, 54791, 63424, 118823, 46126, 56760, 120280, 105204, 69102, 100838, 54896, 101657, 54924, 63570, 118882, 46259, 118891, 127354, 54979, 117220, 118921, 134056, 46287, 127378, 55007, 52406, 118942, 120358, 127394, 55038, 118959, 118970, 63764, 130557, 101737, 57372, 130581, 117319, 63812, 135400, 85939, 46640, 69682, 130605, 131461, 122111, 101027, 120522, 90692, 64072, 46806, 117385, 46831, 46842, 86002, 46857, 119126, 95614, 119134, 117409, 122175, 116001, 117464, 123717, 86080, 108525, 105593, 117491, 120694, 135571, 117500, 5100, 116079, 134412, 117520, 105656, 116121, 120724, 5515, 122378, 133115, 120786, 119385, 126383, 133148, 119410, 117622, 132892, 119418, 135626, 133165, 135642, 133181, 134531, 75560, 135658, 133198, 134547, 119455, 117684, 135674, 133214, 134563, 135690, 133230, 117708, 134579, 133246, 117723, 133262, 133002, 117738, 133020, 64818, 135743, 104352, 133037, 135759, 105981, 133055, 102365, 118031, 135775, 79095, 117791, 86389, 111963, 133072, 102373, 133088, 135819, 79157, 133104, 117835, 135849, 104425, 117846, 107448, 65249, 112778, 125510, 43344, 125522, 102419, 118129, 135884, 114059, 133368, 117871, 104156, 133384, 117898, 43396, 118187, 133402, 129934, 117917, 43447, 133418, 86657, 117927, 129996, 50774, 102530, 117946, 136004, 73226, 118287, 130932, 136063, 132107, 118361, 126896, 86945, 101244, 109095, 37489, 134887, 106375, 14346, 118444, 134905, 102798, 118475, 134929, 101347, 121607, 118515, 125911, 118523, 125928, 113215, 125936, 125951, 118540, 130263, 135025, 27843, 125955, 125960, 101455, 135041, 101465, 44876, 98005, 118575, 135076, 33352, 118596, 118602, 121742, 17612, 63275, 63299, 33703, 117112, 63369, 117123, 63386, 130443, 118811, 63417, 67108, 63446, 118837, 124800, 118857, 103283, 54890, 103290, 54907, 46239, 126172, 54932, 83826, 118886, 117206, 54967, 46283, 98424, 127373, 55002, 118938, 127389, 55023, 118953, 127405, 117253, 63757, 101732, 63778, 134114, 122042, 117302, 123438, 130570, 117315, 130588, 135395, 46635, 119053, 84182, 46658, 117336, 69708, 134157, 88148, 130623, 117351, 64049, 46764, 95566, 117382, 122142, 40905, 74891, 117400, 64224, 117405, 123561, 122172, 47068, 117422, 120603, 86038, 120610, 117437, 117445, 90895, 123714, 101156, 55653, 116028, 101168, 116045, 117484, 117488, 120691, 135566, 117497, 116074, 117504, 20969, 134407, 117517, 134423, 105650, 116115, 111713, 88505, 86195, 110212, 116137, 95981, 117586, 117590, 122389, 119379, 133128, 122411, 122430, 135605, 132885, 117619, 135621, 133159, 116242, 132902, 135637, 133176, 117645, 97004, 99392, 134526, 135653, 133193, 134542, 122467, 135669, 133209, 112563, 134558, 122482, 112568, 135685, 133225, 117703, 134574, 96195, 112590, 97099, 135701, 133241, 64687, 117720, 113893, 133257, 132997, 117731, 133273, 84487, 86344, 117745, 133013, 135738, 133032, 119559, 135754, 133049, 102362, 135770, 104368, 82682, 133067, 135786, 124027, 133083, 135813, 75868, 133099, 121198, 135844, 116458, 86451, 65241, 112773, 106044, 118111, 135860, 106051, 117853, 121224, 43337, 121229, 135878, 102422, 133379, 102438, 133395, 117914, 43433, 133413, 117924, 125616, 129990, 135989, 117943, 50795, 73217, 43501, 112934, 102549, 136021, 118308, 112167, 62257, 29106, 130927, 29154, 136074, 118375, 112222, 122980, 94629, 136119, 84873, 94645, 134881, 118439, 134898, 118450, 110830, 134919, 44486, 101342, 118493, 120004, 44584, 125923, 125946, 130258, 101451, 120061, 32860, 97959, 101460, 63100, 130306, 125975, 33117, 118566, 118571, 135071, 118589, 33305, 118593, 135087, 66841, 121739, 133865, 133865, 115049, 63268, 43337, 118111, 130927, 66929, 55018, 117553, 55030, 60317, 117558, 63312, 122980, 43433, 63381, 133957, 63400, 109587, 63431, 117619, 124027, 85950, 73217, 43501, 116242, 117645, 69146, 69153, 118308, 135279, 117703, 86008, 117720, 117731, 118375, 117745, 63773, 94629, 101743, 125616, 135390, 82682, 94645, 63823, 69695, 118439, 19548, 118450, 101028, 121739, 116458, 123267, 44486, 112563, 117853, 112568, 118493, 64180, 121755, 101901, 112590, 86186, 44584, 120004, 113893, 70080, 117914, 117924, 120061, 101151, 129990, 117943, 118566, 118571, 118589, 118593, 101235, 29106, 112773, 134418, 118635, 29154, 5539, 125923, 84487, 86344, 123433, 125946, 135592, 133122, 125964, 86372, 118824, 135600, 133154, 125991, 103837, 120288, 135632, 133171, 46214, 120301, 122112, 135648, 133188, 134537, 120325, 46274, 118892, 122125, 135664, 133204, 134553, 118922, 135680, 133220, 118929, 134569, 46297, 122165, 135696, 133236, 84642, 118962, 133252, 122182, 123597, 133268, 132692, 120402, 135733, 32677, 64807, 93190, 135749, 46605, 127101, 130269, 135765, 46641, 130311, 33094, 135781, 50788, 90317, 135808, 33279, 135825, 46781, 120523, 33400, 71239, 46794, 65232, 135855, 65255, 126214, 95615, 119130, 95638, 135913, 133374, 39395, 47047, 122369, 133390, 130429, 122379, 130433, 133408, 120616, 107693, 122396, 122402, 130453, 90656, 120968, 136027, 62239, 88260, 127379, 120728, 127395, 119313, 120737, 117274, 112409, 136114, 133008, 130558, 101240, 133027, 130582, 101250, 93741, 133043, 133062, 134876, 133078, 134893, 133094, 134912, 93824, 133110, 14385, 134935, 101337, 117394, 56515, 117416, 41274, 116002, 135031, 27853, 118024, 135047, 117468, 17477, 56806, 54897, 56809, 17561, 54925, 135082, 115033, 54954, 54995, 96456, 118105, 130922, 66922, 75970, 55010, 118117, 125362, 52407, 103132, 63284, 121417, 55040, 63305, 118137, 122968, 98221, 117575, 88878, 43423, 63376, 57374, 43460, 63395, 109575, 117607, 118216, 63425, 117616, 124014, 116237, 103284, 118281, 124039, 117677, 134057, 117717, 118357, 43715, 94567, 118365, 118370, 86027, 63766, 117758, 135385, 86057, 105007, 63813, 135401, 63833, 69684, 86087, 116411, 116426, 121736, 116449, 118480, 118487, 121752, 82898, 117867, 118519, 86192, 117879, 117902, 86211, 117910, 129947, 117921, 64300, 120055, 86225, 117932, 117936, 94861, 117950, 101175, 44905, 130012, 117954, 118581, 86260, 121906, 135572, 45153, 118611, 112767, 134413, 36987, 114049, 114070, 125917, 118725, 29434, 125941, 133116, 118812, 125961, 29644, 118838, 133149, 120285, 118858, 135627, 133166, 46205, 29975, 135643, 133182, 134532, 46263, 118887, 135659, 133199, 134548, 135675, 133215, 134564, 46293, 64634, 135691, 133231, 32583, 64663, 122170, 118954, 133247, 64701, 118971, 122179, 133263, 86605, 46505, 64820, 135744, 95384, 130264, 86659, 135760, 32894, 46636, 135776, 50775, 102369, 97271, 46659, 33152, 33236, 46765, 135820, 46774, 126173, 102389, 112180, 135850, 105651, 65250, 119135, 135885, 133369, 135925, 133385, 113216, 133403, 120613, 122390, 130444, 93467, 71547, 133419, 84879, 109096, 122438, 115642, 136005, 132896, 117186, 136022, 120698, 117215, 127374, 120711, 136064, 120713, 127390, 81439, 119310, 95947, 127406, 95982, 133003, 117303, 133021, 130571, 127460, 104353, 101245, 120787, 133038, 130589, 104363, 119386, 119394, 133056, 123725, 133073, 87371, 130624, 14326, 134888, 133089, 134906, 133105, 134930, 104426, 101332, 117389, 14399, 122783, 114858, 117413, 41484, 135026, 135042, 97968, 54859, 98007, 117485, 56795, 54891, 54911, 135077, 101502, 66807, 54933, 115026, 54949, 98107, 54972, 55003, 116116, 63276, 130933, 55024, 63300, 118130, 122964, 117567, 96498, 67039, 43397, 63370, 67048, 57362, 43449, 63388, 117603, 63418, 117612, 116248, 18741, 103291, 118288, 117685, 117709, 117714, 98449, 118362, 63759, 117739, 132242, 101733, 63779, 63808, 135396, 117786, 64050, 118445, 101029, 117843, 98748, 121749, 118508, 118512, 117874, 110213, 118524, 129935, 132432, 101157, 129997, 101169, 44898, 118576, 135567, 58427, 118603, 134408, 45183, 29119, 112779, 134424, 29177, 118660, 125912, 126872, 114080, 118717, 122033, 125929, 126897, 29375, 29486, 123439, 125952, 86360, 125956, 133129, 46132, 135606, 120281, 111967, 118851, 135622, 133160, 29935, 135638, 133177, 97012, 134527, 120316, 46260, 135654, 133194, 122121, 134543, 118909, 135670, 133210, 134559, 46288, 120344, 122157, 135686, 133226, 122161, 134575, 64648, 135702, 133242, 122176, 123574, 133258, 95362, 133274, 120418, 135739, 130259, 50755, 135755, 46631, 135771, 130307, 46650, 135787, 124795, 50796, 46723, 46729, 46750, 135814, 92677, 46807, 135845, 71302, 46824, 126200, 65242, 46832, 46847, 135861, 46858, 135879, 95623, 120586, 133380, 114454, 130424, 33840, 133396, 122385, 130439, 93461, 133414, 130449, 34155, 83717, 97518, 122434, 135990, 65505, 132890, 95808, 93584, 120695, 90693, 62258, 127369, 122483, 95903, 127385, 95921, 127401, 95977, 132998, 117281, 136120, 133015, 130566, 120770, 117309, 104348, 130577, 133033, 104359, 119380, 117320, 130594, 104369, 133050, 97724, 123718, 123722, 130615, 133068, 134882, 14336, 133084, 117370, 134900, 133100, 75566, 121199, 134920, 117386, 101343, 96197, 87516, 117410, 41469, 135021, 27836, 54794, 119561, 54804, 116013, 56762, 27952, 54883, 135072, 17558, 75870, 118070, 57092, 135088, 66843, 133866, 130913, 117521, 118112, 130928, 55019, 63357, 60382, 43434, 63382, 117594, 133958, 118208, 133962, 63402, 73189, 63432, 68236, 125453, 101633, 85951, 117626, 73218, 103285, 109646, 69147, 98378, 82316, 110018, 125505, 117704, 125517, 123112, 117727, 117733, 131084, 117746, 63774, 135391, 117782, 69665, 35558, 94646, 117792, 35754, 64017, 44385, 118440, 117833, 69758, 117839, 64097, 118481, 121746, 117850, 112564, 118494, 110194, 111709, 117860, 112585, 44587, 120005, 91908, 101102, 117906, 129942, 98955, 120068, 35947, 101152, 117940, 44879, 118567, 117958, 118590, 58421, 112756, 29107, 112768, 134419, 126863, 86318, 125924, 29351, 125934, 86338, 84490, 123434, 125947, 135593, 133123, 125966, 99295, 118825, 135601, 125971, 29719, 118846, 133155, 125992, 135633, 133172, 83381, 46255, 135649, 133189, 134538, 118893, 122126, 135665, 133205, 134554, 46284, 120338, 135681, 133221, 134570, 120362, 135697, 133237, 110522, 95304, 84644, 105505, 122173, 118963, 133253, 123598, 133269, 117276, 84482, 48324, 122380, 133009, 135734, 43733, 125942, 103194, 122397, 133028, 135750, 122403, 117316, 135032, 133044, 125966, 135766, 98957, 125971, 117324, 135048, 133063, 135782, 125992, 101177, 133079, 135809, 120692, 83381, 133095, 135826, 135083, 71241, 133111, 133861, 117383, 135856, 120709, 117401, 114050, 117406, 84644, 117423, 44660, 120753, 114125, 117438, 101739, 44743, 117446, 109577, 99295, 94862, 117489, 117518, 130923, 56516, 101897, 63285, 101907, 29224, 63306, 116144, 117576, 136115, 63377, 117587, 117591, 63396, 135386, 27882, 118019, 117608, 63426, 118025, 118032, 29719, 117623, 130013, 117632, 54899, 46255, 54926, 102019, 75561, 54962, 17618, 46284, 55011, 121418, 95304, 118138, 105505, 63746, 117724, 63767, 57375, 18307, 46607, 118217, 63815, 46642, 123715, 33013, 117788, 69685, 46710, 33218, 118283, 116428, 33281, 135573, 33355, 46782, 121593, 117836, 46803, 116450, 117847, 134414, 64220, 99999, 95616, 118358, 123107, 39392, 47027, 95639, 117880, 118371, 117899, 117918, 73119, 132438, 133123, 117928, 130312, 117947, 133155, 117951, 95799, 117955, 118434, 133172, 117966, 133189, 134538, 118476, 121743, 133205, 134554, 118488, 133221, 134570, 133237, 118516, 111722, 118520, 133253, 130419, 133269, 130430, 95992, 130434, 120056, 130454, 85944, 118562, 118582, 118614, 106040, 118628, 125511, 127380, 127396, 104471, 41268, 133375, 98222, 133391, 86032, 118726, 123429, 122043, 130559, 133409, 101241, 130583, 101251, 118825, 130610, 118846, 98369, 43330, 118893, 122126, 65233, 90480, 120338, 96459, 101338, 65256, 82901, 120362, 110522, 122173, 118963, 123598, 117113, 43425, 98536, 109310, 101452, 119049, 50778, 132893, 101479, 135628, 134889, 135644, 134907, 106436, 112181, 135660, 134931, 43592, 117217, 135676, 62271, 43651, 112571, 135692, 119136, 94548, 125913, 94561, 125930, 84475, 120601, 133004, 125937, 86345, 122391, 133022, 135745, 120620, 117313, 135027, 106515, 133039, 125962, 135761, 122431, 135043, 133057, 135777, 125987, 101170, 133074, 135804, 120688, 133090, 135821, 135078, 133106, 122468, 117380, 112769, 135851, 112780, 117398, 13296, 135886, 117420, 135926, 86606, 101734, 117455, 35945, 63156, 44899, 119412, 117472, 124803, 124808, 116047, 117486, 136006, 66808, 126174, 14377, 29121, 95074, 63277, 136065, 95107, 63301, 97112, 116139, 63321, 27588, 63371, 117582, 86947, 129936, 29493, 63389, 63421, 46113, 135397, 129998, 117620, 130007, 134159, 28081, 54893, 28118, 46220, 54912, 54934, 46280, 118100, 54973, 55004, 52401, 117710, 32573, 46303, 81440, 55026, 118131, 55031, 117721, 63760, 131095, 126898, 117741, 46494, 118189, 57363, 32791, 63809, 46637, 123712, 46662, 89284, 33162, 116421, 118289, 46767, 135568, 116445, 134409, 134425, 105652, 95611, 119814, 117875, 123118, 118376, 33836, 33847, 117915, 132433, 133117, 117925, 85811, 119915, 117944, 133150, 133167, 133183, 107413, 134533, 121740, 133200, 134549, 102399, 133216, 134565, 118509, 133232, 118513, 34492, 133248, 95948, 118525, 110217, 104159, 61009, 133264, 95983, 104364, 125447, 124028, 98010, 118573, 131458, 118577, 118594, 118605, 121945, 85993, 118640, 127375, 86009, 118661, 127391, 64664, 133370, 133386, 118718, 64799, 133404, 82594, 130572, 133420, 127461, 130578, 101246, 118813, 130590, 109097, 118839, 120278, 65125, 118859, 130625, 100840, 82814, 94191, 118888, 65228, 65251, 118939, 120353, 110512, 118955, 96499, 117110, 43404, 122186, 43451, 67111, 120073, 118650, 125967, 91981, 125980, 125931, 125977, 120590, 125503, 118547, 118865, 119051, 121606, 117615, 125968, 117441, 125978, 120594, 125504, 117859, 120242, 120591, 118018, 125983, 117461, 121858, 118061, 125979, 121608, 117204, 120592, 125976, 102357, 34452, 118924, 110947, 90579, 1303, 1309, 13698, 63793, 47014, 5112, 102420, 52433, 1304, 5045, 50859, 85970, 84325, 12520, 12520, 67288, 1305, 1310, 110944, 33416, 9559, 10130, 96670, 85355, 117444, 13229, 116128, 119019, 122469, 122472, 99406, 123601, 1306, 1311, 122815, 5670, 13703, 13707, 63800, 91985, 12515, 6, 98950, 35498, 98956, 1312, 5357, 13317, 18562, 43652, 33458, 80038, 1307, 1313, 5542, 121596, 13166, 17515, 14389, 117376, 1278, 1334, 124030, 50858, 50899, 96668, 12519, 130918, 119023, 1302, 1308, 39542, 119018, 33457, 10129, 11474, 13262, 84181, 294, 130002, 9565, 143, 40297, 35544, 130308, 124031, 1814, 12637, 300, 124029, 5510, 102385, 7968, 13039, 14193, 130001, 102381, 585, 102384, 71640, 5472, 18384, 5168, 11447, 11478, 5663, 9887, 5956, 5971, 13170, 5999, 9560, 13203, 5066, 53, 10127, 13172, 9561, 12669, 13242, 510, 6737, 10149, 7651, 13153, 13228, 13169, 130414, 5543, 6562, 1773, 5058, 130406, 6494, 8485, 6496, 5676, 6520, 62772, 1772, 13032, 6521, 9906, 732, 1691, 1828, 11473, 6005, 5390, 94, 5102, 118, 5867, 410, 5391, 6297, 1399, 1794, 782, 783, 9885, 5541, 6448, 8514, 43, 846, 1355, 12971]

    count = 0
    for product_id in products:
        print("########: ", count)
        try:
            product_detail = None
            big_product = api.products_by_id(product_id)
            if big_product != None:
                product_quantity = api.stock_by_id(product_id)
                try:
                    entry = BigBuyProduct.get(BigBuyProduct.product_id==product_id)
                except:
                    product_detail = api.product_information(product_id)
                    if product_detail == None:
                        time.sleep(5)
                        product_detail = api.product_information(product_id)

                    if product_detail != None:
                        product_image = api.get_image_by_id(product_id)
                        time.sleep(1)
                        tags = api.producttag_by_id(product_id)

                        entry = BigBuyProduct(product_id=big_product['id'],
                                            name=product_detail['name'],
                                            sku=big_product['sku'],
                                            ean13=big_product['ean13'],
                                            image=product_image,
                                            category='kitchen',
                                            retail_price=big_product['retailPrice'],
                                            wholesale_price=big_product['wholesalePrice'],
                                            depth=big_product['depth'],
                                            description=product_detail['description'],
                                            tags=tags)
                        entry.save()

                if product_detail != None:
                    entry.retail_price=big_product['retailPrice']
                    entry.wholesale_price=big_product['wholesalePrice']
                    entry.save()

                    try:
                        run_shopify_upload(entry, api)
                    except:
                        try:
                            run_shopify_upload(entry, api)
                        except:
                            run_shopify_upload(entry, api)

        except Exception as ee:
            print("######## Reconnect {} #######: {}".format(entry.name, str(ee)))
            pass
        time.sleep(5)
        count = count + 1
